<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Takeoff Performance Calculators</title>
    
    <!-- Incluindo Tailwind CSS para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Incluindo a fonte Inter do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Estilo customizado para usar a fonte Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Cor de fundo "Céu Limpo" (slate-50) */
        }

        /* Animação para a barra de progresso horizontal */
        .n1-progress-bar, #weight-progress-bar {
            transition: width 0.8s cubic-bezier(0.65, 0, 0.35, 1), background-color 0.5s ease;
        }

        /* Estilo para animação de fade-in e scale-up */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Ajustes de foco para acessibilidade */
        input:focus, select:focus, button:focus {
            outline: none;
        }
        input:focus-visible, select:focus-visible {
             box-shadow: 0 0 0 2px #f8fafc, 0 0 0 4px #1d4ed8;
        }

        /* Estilos para as abas */
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #1d4ed8;
            color: white;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-sm p-6 sm:p-8 bg-white rounded-2xl shadow-lg">
        
        <!-- Abas de Navegação -->
        <div class="grid grid-cols-3 bg-slate-100 rounded-lg p-1 mb-6">
            <button id="tab-btn-full" class="tab-button active w-full py-2 text-sm font-bold text-slate-600 rounded-md">Full Power</button>
            <button id="tab-btn-partial" class="tab-button w-full py-2 text-sm font-bold text-slate-600 rounded-md">Partial Power</button>
            <button id="tab-btn-weight" class="tab-button w-full py-2 text-sm font-bold text-slate-600 rounded-md">Weight Limits</button>
        </div>

        <!-- Conteúdo da Calculadora de Full Power -->
        <div id="calculator-full">
            <header class="text-center mb-6">
                <h1 class="text-lg sm:text-xl font-bold text-slate-800 tracking-wide">Takeoff Power Settings (N1%) AI OFF</h1>
            </header>
            <div class="space-y-4">
                <div>
                    <label for="altitude_full" class="text-sm font-semibold text-slate-600">Altitude (Ft)</label>
                    <input type="number" id="altitude_full" placeholder="Ex: 9000" class="mt-1 block w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 transition-all duration-300">
                </div>
                <div>
                    <label for="temperature_full" class="text-sm font-semibold text-slate-600">OAT</label>
                    <div class="mt-1 flex gap-2">
                        <input type="number" id="temperature_full" placeholder="Ex: 90" class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 z-10 transition-all duration-300">
                        <select id="temp-unit_full" class="bg-slate-200 text-slate-800 font-medium rounded-lg px-4 border border-slate-200 transition-all duration-300">
                            <option value="C">°C</option>
                            <option value="F" selected>°F</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="mt-8">
                <button id="calculate-btn-full" class="w-full bg-blue-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-400/50 transition-all duration-300 active:scale-[0.98]">Calcular Potência N1:</button>
            </div>
             <div id="result-container-full" class="mt-6">
                 <div id="bar-display-full" class="w-full">
                    <div>
                        <div class="bg-slate-200 rounded-lg h-6 w-full overflow-hidden">
                            <div id="n1-progress-bar-full" class="n1-progress-bar h-6 rounded-lg bg-emerald-500" style="width: 0%;"></div>
                        </div>
                         <div class="flex justify-between text-xs font-medium text-slate-500 px-1 mt-1">
                            <span>0</span><span>20</span><span>40</span><span>60</span><span>80</span><span>100</span>
                        </div>
                    </div>
                    <div class="text-center text-2xl font-bold text-slate-800 pt-4">
                         <span id="n1-value-display-full">0.0%</span>
                    </div>
                </div>
                <div id="error-display-full" class="hidden"></div>
            </div>
        </div>
        
        <!-- Conteúdo da Calculadora de Partial Power -->
        <div id="calculator-partial" class="hidden">
            <header class="text-center mb-6">
                <h1 class="text-lg sm:text-xl font-bold text-slate-800 tracking-wide">Partial Power Takeoff N1 Setting AI OFF</h1>
            </header>
            <div class="space-y-4">
                 <div>
                    <label for="oat_partial" class="text-sm font-semibold text-slate-600">Outside Air Temp. (OAT)</label>
                    <div class="mt-1 flex gap-2">
                        <input type="number" id="oat_partial" placeholder="Ex: 30" class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 z-10 transition-all duration-300">
                        <select id="oat-unit_partial" class="bg-slate-200 text-slate-800 font-medium rounded-lg px-4 border border-slate-200 transition-all duration-300">
                            <option value="C">°C</option>
                            <option value="F" selected>°F</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="assumed_temp_partial" class="text-sm font-semibold text-slate-600">Assumed Temperature</label>
                    <div class="mt-1 flex gap-2">
                        <input type="number" id="assumed_temp_partial" placeholder="Ex: 80" class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 z-10 transition-all duration-300">
                        <select id="assumed-unit_partial" class="bg-slate-200 text-slate-800 font-medium rounded-lg px-4 border border-slate-200 transition-all duration-300">
                            <option value="C">°C</option>
                            <option value="F" selected>°F</option>
                        </select>
                    </div>
                </div>
            </div>
             <div class="mt-8">
                <button id="calculate-btn-partial" class="w-full bg-blue-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-400/50 transition-all duration-300 active:scale-[0.98]">Calcular Potência N1:</button>
            </div>
            <div id="result-container-partial" class="mt-6">
                 <div id="bar-display-partial" class="w-full">
                    <div>
                        <div class="bg-slate-200 rounded-lg h-6 w-full overflow-hidden">
                            <div id="n1-progress-bar-partial" class="n1-progress-bar h-6 rounded-lg bg-emerald-500" style="width: 0%;"></div>
                        </div>
                         <div class="flex justify-between text-xs font-medium text-slate-500 px-1 mt-1">
                            <span>0</span><span>20</span><span>40</span><span>60</span><span>80</span><span>100</span>
                        </div>
                    </div>
                    <div class="text-center text-2xl font-bold text-slate-800 pt-4">
                         <span id="n1-value-display-partial">0.0%</span>
                    </div>
                </div>
                <div id="error-display-partial" class="hidden"></div>
            </div>
        </div>

        <!-- Conteúdo da Calculadora de Weight Limits -->
        <div id="calculator-weight" class="hidden">
            <header class="text-center mb-6">
                <h1 class="text-lg sm:text-xl font-bold text-slate-800 tracking-wide">Takeoff Weight Limits - Flaps 8°</h1>
            </header>
            <div class="space-y-4">
                <div>
                    <label for="altitude_weight" class="text-sm font-semibold text-slate-600">Pressure Altitude (Ft)</label>
                    <input type="number" id="altitude_weight" placeholder="Ex: 5000" class="mt-1 block w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 transition-all duration-300">
                </div>
                <div>
                    <label for="temperature_weight" class="text-sm font-semibold text-slate-600">Temperature</label>
                    <div class="mt-1 flex gap-2">
                        <input type="number" id="temperature_weight" placeholder="Ex: 80" class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 z-10 transition-all duration-300">
                        <select id="temp-unit_weight" class="bg-slate-200 text-slate-800 font-medium rounded-lg px-4 border border-slate-200 transition-all duration-300">
                            <option value="C">°C</option>
                            <option value="F" selected>°F</option>
                        </select>
                    </div>
                </div>
            </div>
             <div class="mt-8">
                <button id="calculate-btn-weight" class="w-full bg-blue-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-400/50 transition-all duration-300 active:scale-[0.98]">Calcular Limite de Peso:</button>
            </div>
            <div id="result-container-weight" class="mt-6">
                <div id="bar-display-weight" class="w-full">
                    <div>
                        <div class="bg-slate-200 rounded-lg h-6 w-full overflow-hidden">
                            <div id="weight-progress-bar" class="h-6 rounded-lg bg-emerald-500" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="text-center text-2xl font-bold text-slate-800 pt-4">
                         <span id="weight-value-display">0 lbs</span>
                    </div>
                </div>
                <div id="error-display-weight" class="hidden"></div>
            </div>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATA TABLES ---
            const n1FullPowerTable = [
                { tempC: -51,n1_values: [84.0, 84.8, 85.6, 86.6, 87.5, 88.3, 89.3, 90.0, 90.8, 92.2, 93.8] }, { tempC: -46,n1_values: [85.0, 85.8, 86.6, 87.6, 88.5, 89.4, 90.3, 91.0, 91.8, 93.3, 94.9] }, { tempC: -40,n1_values: [86.0, 86.8, 87.6, 88.6, 89.6, 90.4, 91.3, 92.1, 92.9, 94.4, 96.0] }, { tempC: -34,n1_values: [86.9, 87.8, 88.6, 89.6, 90.6, 91.5, 92.4, 93.1, 94.0, 95.4, 97.1] }, { tempC: -29,n1_values: [87.9, 88.8, 89.5, 90.6, 91.6, 92.5, 93.4, 94.2, 95.0, 96.5, 98.2] }, { tempC: -23,n1_values: [88.9, 89.8, 90.5, 91.6, 92.6, 93.6, 94.4, 95.2, 96.1, 97.6, 99.2] }, { tempC: -18,n1_values: [89.8, 90.8, 91.6, 92.6, 93.7, 94.6, 95.5, 96.3, 97.2, 98.6, 100.0] }, { tempC: -15,n1_values: [90.4, 91.2, 92.0, 93.1, 94.2, 95.1, 96.0, 96.8, 97.7, 99.2, 100.0] }, { tempC: -12,n1_values: [90.8, 91.8, 92.6, 93.6, 94.7, 95.7, 96.5, 97.4, 98.2, 99.7, 100.0] }, { tempC: -9, n1_values: [91.4, 92.3, 93.0, 94.2, 95.2, 96.2, 97.0, 97.9, 98.7, 100.0, 100.0] }, { tempC: -7, n1_values: [91.9, 92.8, 93.6, 94.7, 95.8, 96.7, 97.6, 98.4, 99.2, 99.8, 99.8] }, { tempC: -4, n1_values: [92.4, 93.4, 94.1, 95.2, 96.3, 97.2, 98.1, 99.0, 99.6, 99.6, 99.6] }, { tempC: -1, n1_values: [92.9, 93.9, 94.6, 95.7, 96.8, 97.8, 98.6, 99.4, 99.4, 99.4, 99.4] }, { tempC: 2,  n1_values: [93.4, 94.4, 95.2, 96.2, 97.3, 98.3, 99.1, 99.1, 99.1, 99.1, 99.1] }, { tempC: 4,  n1_values: [94.0, 95.0, 95.7, 96.7, 97.8, 98.8, 98.8, 98.8, 98.8, 98.8, 98.8] }, { tempC: 7,  n1_values: [94.4, 95.4, 96.2, 97.2, 98.3, 98.6, 98.6, 98.6, 98.6, 98.6, 98.6] }, { tempC: 10, n1_values: [95.0, 96.0, 96.7, 97.8, 98.3, 98.3, 98.3, 98.3, 98.3, 98.3, 98.3] }, { tempC: 13, n1_values: [95.5, 96.5, 97.2, 97.9, 97.9, 97.9, 97.9, 97.9, 97.9, 97.9, 97.9] }, { tempC: 16, n1_values: [96.0, 97.0, 97.5, 97.5, 97.5, 97.5, 97.5, 97.5, 97.5, 97.5, 97.5] }, { tempC: 18, n1_values: [97.1, 97.1, 97.1, 97.1, 97.1, 97.1, 97.1, 97.1, 97.1, 97.1, 97.1] }, { tempC: 21, n1_values: [96.6, 96.6, 96.6, 96.6, 96.6, 96.6, 96.6, 96.6, 96.6, 96.6, 96.6] }, { tempC: 24, n1_values: [96.0, 96.0, 96.0, 96.0, 96.0, 96.0, 96.0, 96.0, 96.0, 96.0, 96.0] }, { tempC: 27, n1_values: [95.4, 95.4, 95.4, 95.4, 95.4, 95.4, 95.4, 95.4, 95.4, 95.4, 95.4] }, { tempC: 29, n1_values: [94.7, 94.7, 94.7, 94.7, 94.7, 94.7, 94.7, 94.7, 94.7, 94.7, 94.7] }, { tempC: 32, n1_values: [94.0, 94.0, 94.0, 94.0, 94.0, 94.0, 94.0, 94.0, 94.0, 94.0, null] }, { tempC: 35, n1_values: [93.1, 93.1, 93.1, 93.1, 93.1, 93.1, 93.1, 93.1, null, null, null] }, { tempC: 38, n1_values: [92.2, 92.2, 92.2, 92.2, 92.2, 92.2, 92.2, null, null, null, null] }, { tempC: 41, n1_values: [91.3, 91.3, 91.3, 91.3, 91.3, 91.3, null, null, null, null, null] }, { tempC: 43, n1_values: [90.4, 90.4, 90.4, 90.4, 90.4, null, null, null, null, null, null] }, { tempC: 46, n1_values: [89.4, 89.4, 89.4, 89.4, null, null, null, null, null, null, null] }, { tempC: 49, n1_values: [88.4, 88.4, 89.4, null, null, null, null, null, null, null, null] }
            ];
            const n1PartialPowerTable = {
                assumedTemps: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                oatRows: [
                    { oat: 80, values: [null, null, null, null, null, null, null, null, 93.2, 90.8] }, { oat: 70, values: [null, null, null, null, null, null, null, 94.4, 92.1, 89.9] }, { oat: 60, values: [null, null, null, null, null, 95.6, 93.5, 91.3, 89.0, null] }, { oat: 50, values: [null, null, null, null, 96.6, 94.6, 92.6, 90.4, 88.1, null] }, { oat: 40, values: [null, null, null, 97.4, 95.8, 93.7, 91.8, 89.6, 87.2, null] }, { oat: 30, values: [null, null, 97.9, 96.4, 94.7, 92.8, 90.9, 88.7, 86.4, null] }, { oat: 20, values: [null, 98.3, 96.9, 95.3, 93.8, 91.8, 90.0, 87.9, 85.6, null] }, { oat: 10, values: [98.5, 97.2, 95.9, 94.4, 92.8, 90.9, 89.0, 86.9, 84.6, null] }, { oat: 0,  values: [98.8, 97.6, 96.3, 94.9, 93.4, 91.8, 90.0, 88.1, 85.9, 83.6] }, { oat: -10,values: [97.5, 96.4, 95.2, 93.9, 92.4, 90.7, 88.9, 87.1, 85.0, 82.8] }, { oat: -20,values: [96.5, 95.5, 94.4, 92.9, 91.3, 89.7, 87.9, 86.1, 84.1, 82.0] }, { oat: -30,values: [95.5, 94.4, 93.2, 91.8, 90.3, 88.7, 86.9, 85.1, 83.1, 81.0] }, { oat: -40,values: [94.5, 93.4, 92.2, 90.9, 89.3, 87.7, 85.9, 84.1, 82.1, 80.0] },
                ]
            };
            const takeoffWeightTable = {
                temps: [0, 20, 40, 60, 80, 100], // in Fahrenheit
                altitudes: [10000, 9000, 8000, 7000, 6000, 5000, 4000, 3000, 2000, 1000, 0],
                weights: [ // CORRECTED DATA based on chart arrows
                    // Temps:  0      20     40      60      80     100
                    [18300, 18300, 17750, 16800, 14850, null ],    // Alt 10000
                    [18300, 18300, 18300, 17400, 15400, null ],    // Alt 9000
                    [18300, 18300, 18300, 17950, 16050, null ],    // Alt 8000
                    [18300, 18300, 18300, 18300, 16600, null ],    // Alt 7000
                    [18300, 18300, 18300, 18300, 17300, 15050],    // Alt 6000
                    [18300, 18300, 18300, 18300, 17900, 15600],    // Alt 5000
                    [18300, 18300, 18300, 18300, 18300, 16200],    // Alt 4000
                    [18300, 18300, 18300, 18300, 18300, 16800],    // Alt 3000
                    [18300, 18300, 18300, 18300, 18300, 17400],    // Alt 2000
                    [18300, 18300, 18300, 18300, 18300, 18100],    // Alt 1000
                    [18300, 18300, 18300, 18300, 18300, 18300],    // Alt 0 (S.L.)
                ]
            };

            // --- TAB SWITCHING LOGIC ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const calculators = {
                full: document.getElementById('calculator-full'),
                partial: document.getElementById('calculator-partial'),
                weight: document.getElementById('calculator-weight'),
            };

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    Object.values(calculators).forEach(calc => calc.classList.add('hidden'));
                    button.classList.add('active');
                    const calcId = button.id.split('-')[2];
                    calculators[calcId].classList.remove('hidden');
                });
            });

            // --- GENERAL HELPER FUNCTIONS ---
            const animateValue = (obj, start, end, duration, unit = '%', precision = 1) => {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const currentValue = progress * (end - start) + start;
                    obj.textContent = `${currentValue.toFixed(precision)}${unit}`;
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            };

             const displayN1Result = (calcType, numericValue, isError = false, errorMessage = '') => {
                const barDisplay = document.getElementById(`bar-display-${calcType}`);
                const errorDisplay = document.getElementById(`error-display-${calcType}`);
                const progressBar = document.getElementById(`n1-progress-bar-${calcType}`);
                const n1ValueDisplay = document.getElementById(`n1-value-display-${calcType}`);

                if (isError) {
                    barDisplay.classList.add('hidden');
                    errorDisplay.classList.remove('hidden');
                    errorDisplay.innerHTML = `<p class="p-4 bg-red-100 text-red-700 rounded-lg text-center fade-in-up">${errorMessage}</p>`;
                } else {
                    barDisplay.classList.remove('hidden');
                    errorDisplay.classList.add('hidden');

                    let colorClass = 'bg-rose-600'; 
                    if (numericValue <= 90) { colorClass = 'bg-emerald-500'; } else if (numericValue <= 96) { colorClass = 'bg-amber-400'; }
                    
                    progressBar.className = `h-6 rounded-lg ${colorClass}`;
                    progressBar.style.width = `${numericValue}%`;
                    
                    if(n1ValueDisplay && numericValue !== null){
                        const currentDisplayedValue = parseFloat(n1ValueDisplay.textContent) || 0;
                        animateValue(n1ValueDisplay, currentDisplayedValue, numericValue, 800);
                    }
                }
            };
            
            const toFahrenheit = (celsius) => celsius * 9/5 + 32;
            const toCelsius = (fahrenheit) => (fahrenheit - 32) * 5/9;
            const interpolate = (point, p1, v1, p2, v2) => {
                if (p1 === p2) return v1;
                if (v1 === null || v2 === null) return null;
                return v1 + (v2 - v1) * (point - p1) / (p2 - p1);
            };


            // --- FULL POWER CALCULATOR LOGIC ---
            document.getElementById('calculate-btn-full').addEventListener('click', calculateFullPower);
            function calculateFullPower() {
                const altitude = parseFloat(document.getElementById('altitude_full').value);
                let temperature = parseFloat(document.getElementById('temperature_full').value);
                const tempUnit = document.getElementById('temp-unit_full').value;
                if (isNaN(altitude) || isNaN(temperature)) { displayN1Result('full', null, true, "Por favor, preencha todos os campos."); return; }
                if (tempUnit === 'F') temperature = toCelsius(temperature);
                if (altitude < 0 || altitude > 10000 || temperature > 49 || temperature < -51) { displayN1Result('full', null, true, "Fora dos limites operacionais. Verifique o manual"); return; }
                const getAltitudeN1 = (tempRow, alt) => { const altIndex = alt / 1000; const lowerAltIndex = Math.floor(altIndex); const upperAltIndex = Math.ceil(altIndex); const n1AtLowerAlt = tempRow.n1_values[lowerAltIndex]; if (n1AtLowerAlt === null) return null; if (lowerAltIndex === upperAltIndex) return n1AtLowerAlt; const n1AtUpperAlt = tempRow.n1_values[upperAltIndex]; if (n1AtUpperAlt === null) return n1AtLowerAlt; return interpolate(alt, lowerAltIndex * 1000, n1AtLowerAlt, upperAltIndex * 1000, n1AtUpperAlt); };
                const upperTempRow = n1FullPowerTable.find(row => row.tempC >= temperature); const lowerTempRow = [...n1FullPowerTable].reverse().find(row => row.tempC <= temperature);
                if (!lowerTempRow || !upperTempRow) { displayN1Result('full', null, true, "Fora dos limites operacionais. Verifique o manual"); return; }
                if (lowerTempRow.tempC === upperTempRow.tempC) { const finalN1 = getAltitudeN1(lowerTempRow, altitude); if(finalN1 === null) { displayN1Result('full', null, true, "Fora dos limites operacionais. Verifique o manual"); } else { displayN1Result('full', finalN1, false); } return; }
                const n1AtLowerTemp = getAltitudeN1(lowerTempRow, altitude); if (n1AtLowerTemp === null) { displayN1Result('full', null, true, "Fora dos limites operacionais. Verifique o manual"); return; }
                const n1AtUpperTemp = getAltitudeN1(upperTempRow, altitude); if (n1AtUpperTemp === null) { displayN1Result('full', n1AtLowerTemp, false); return; }
                const finalN1 = interpolate(temperature, lowerTempRow.tempC, n1AtLowerTemp, upperTempRow.tempC, n1AtUpperTemp); displayN1Result('full', finalN1, false);
            }

            // --- PARTIAL POWER CALCULATOR LOGIC ---
            document.getElementById('calculate-btn-partial').addEventListener('click', calculatePartialPower);
            function calculatePartialPower() {
                let oat = parseFloat(document.getElementById('oat_partial').value); const oatUnit = document.getElementById('oat-unit_partial').value; let assumedTemp = parseFloat(document.getElementById('assumed_temp_partial').value); const assumedTempUnit = document.getElementById('assumed-unit_partial').value;
                if (isNaN(oat) || isNaN(assumedTemp)) { displayN1Result('partial', null, true, "Por favor, preencha todos os campos."); return; }
                if (oatUnit === 'C') oat = toFahrenheit(oat); if (assumedTempUnit === 'C') assumedTemp = toFahrenheit(assumedTemp);
                if (oat < -40 || oat > 80 || assumedTemp < 10 || assumedTemp > 100) { displayN1Result('partial', null, true, "Fora dos limites operacionais. Verifique o manual"); return; }
                const getAssumedTempN1 = (oatRow, temp) => { const assumedTemps = n1PartialPowerTable.assumedTemps; const upperIndex = assumedTemps.findIndex(t => t >= temp); if (upperIndex === -1) { return null; } if (upperIndex === 0) { return oatRow.values[0]; } const lowerIndex = upperIndex - 1; if (assumedTemps[upperIndex] === temp) { return oatRow.values[upperIndex]; } const lowerTemp = assumedTemps[lowerIndex]; const upperTemp = assumedTemps[upperIndex]; const n1AtLower = oatRow.values[lowerIndex]; const n1AtUpper = oatRow.values[upperIndex]; return interpolate(temp, lowerTemp, n1AtLower, upperTemp, n1AtUpper); };
                const upperOatRow = [...n1PartialPowerTable.oatRows].reverse().find(row => row.oat >= oat); const lowerOatRow = n1PartialPowerTable.oatRows.find(row => row.oat <= oat);
                if (!lowerOatRow || !upperOatRow) { displayN1Result('partial', null, true, "Fora dos limites operacionais. Verifique o manual"); return; }
                if (lowerOatRow.oat === upperOatRow.oat) { const finalN1 = getAssumedTempN1(lowerOatRow, assumedTemp); if (finalN1 === null) { displayN1Result('partial', null, true, "Fora dos limites operacionais. Verifique o manual"); } else { displayN1Result('partial', finalN1, false); } return; }
                const n1AtLowerOat = getAssumedTempN1(lowerOatRow, assumedTemp); const n1AtUpperOat = getAssumedTempN1(upperOatRow, assumedTemp); if (n1AtLowerOat === null || n1AtUpperOat === null) { displayN1Result('partial', null, true, "Fora dos limites operacionais. Verifique o manual"); return; }
                const finalN1 = interpolate(oat, lowerOatRow.oat, n1AtLowerOat, upperOatRow.oat, n1AtUpperOat); displayN1Result('partial', finalN1, false);
            }

            // --- WEIGHT LIMIT CALCULATOR LOGIC (CORRECTED) ---
            document.getElementById('calculate-btn-weight').addEventListener('click', calculateWeightLimit);
            function calculateWeightLimit() {
                const altitude = parseFloat(document.getElementById('altitude_weight').value);
                let temperature = parseFloat(document.getElementById('temperature_weight').value);
                const tempUnit = document.getElementById('temp-unit_weight').value;

                const displayWeightResult = (numericValue, isError = false, errorMessage = '') => {
                    const barDisplay = document.getElementById('bar-display-weight');
                    const errorDisplay = document.getElementById('error-display-weight');
                    const progressBar = document.getElementById('weight-progress-bar');
                    const valueDisplay = document.getElementById('weight-value-display');

                    if (isError) {
                        barDisplay.classList.add('hidden');
                        errorDisplay.classList.remove('hidden');
                        errorDisplay.innerHTML = `<p class="p-4 bg-red-100 text-red-700 rounded-lg text-center fade-in-up">${errorMessage}</p>`;
                    } else {
                        barDisplay.classList.remove('hidden');
                        errorDisplay.classList.add('hidden');

                        const MAX_WEIGHT = 18300;
                        const widthPercentage = (numericValue / MAX_WEIGHT) * 100;

                        let colorClass = 'bg-rose-600';
                        if (numericValue <= 16500) { colorClass = 'bg-emerald-500'; } 
                        else if (numericValue <= 17500) { colorClass = 'bg-amber-400';}
                        
                        progressBar.className = `h-6 rounded-lg ${colorClass}`;
                        progressBar.style.width = `${widthPercentage}%`;
                        
                        if(valueDisplay && numericValue !== null){
                            const currentDisplayedValue = parseFloat(valueDisplay.textContent) || 0;
                            animateValue(valueDisplay, currentDisplayedValue, numericValue, 800, ' lbs', 0);
                        }
                    }
                };

                if (isNaN(altitude) || isNaN(temperature)) {
                    displayWeightResult(null, true, "Por favor, preencha todos os campos.");
                    return;
                }
                
                if (tempUnit === 'C') temperature = toFahrenheit(temperature);

                if (altitude < 0 || altitude > 10000 || temperature < 0 || temperature > 100) {
                    displayWeightResult(null, true, "Fora dos limites operacionais. Verifique o manual");
                    return;
                }

                // Bilinear interpolation logic
                const getWeight = (alt, temp) => {
                    const altitudes = takeoffWeightTable.altitudes;
                    const temps = takeoffWeightTable.temps;
                    const weights = takeoffWeightTable.weights;

                    const y_upper_idx = altitudes.findIndex(a => a <= alt);
                    if (y_upper_idx === -1) return null;
                    const y_lower_idx = y_upper_idx > 0 ? y_upper_idx - 1 : 0;
                    
                    const x_upper_idx = temps.findIndex(t => t >= temp);
                    if (x_upper_idx === -1) return null;
                    const x_lower_idx = x_upper_idx > 0 ? x_upper_idx - 1 : 0;
                    
                    const y1 = altitudes[y_lower_idx];
                    const y2 = altitudes[y_upper_idx];
                    const x1 = temps[x_lower_idx];
                    const x2 = temps[x_upper_idx];
                    
                    const Q11 = weights[y_lower_idx][x_lower_idx];
                    const Q12 = weights[y_lower_idx][x_upper_idx];
                    const Q21 = weights[y_upper_idx][x_lower_idx];
                    const Q22 = weights[y_upper_idx][x_upper_idx];
                    
                    if (alt === y2 && temp === x2 && Q22 !== null) return Q22;
                    if (alt === y2 && temp === x1 && Q21 !== null) return Q21;
                    if (alt === y1 && temp === x2 && Q12 !== null) return Q12;
                    if (alt === y1 && temp === x1 && Q11 !== null) return Q11;

                    const R1 = interpolate(temp, x1, Q11, x2, Q12);
                    const R2 = interpolate(temp, x1, Q21, x2, Q22);
                    
                    if (R1 === null || R2 === null) return null;

                    const finalWeight = interpolate(alt, y1, R1, y2, R2);
                    return finalWeight;
                }

                const finalWeight = getWeight(altitude, temperature);

                if (finalWeight === null) {
                    displayWeightResult(null, true, "Fora dos limites operacionais. Verifique o manual");
                } else {
                    displayWeightResult(finalWeight, false);
                }
            }
        });
    </script>
</body>
</html>
